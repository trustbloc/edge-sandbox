#
# SecureKey Technologies Inc. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '3'

services:

  issuer.example.com:
    container_name: issuer.example.com
    image: ${ISSUER_IMAGE}:latest
    environment:
      - ISSUER_HOST_URL=0.0.0.0:5556
      # TODO Add tls config for hydra http client https://github.com/trustbloc/edge-sandbox/issues/174
      - OAUTH2_ENDPOINT_AUTH_URL=http://127.0.0.1:4444/oauth2/auth
      # TODO Add tls config for hydra http client https://github.com/trustbloc/edge-sandbox/issues/174
      - OAUTH2_ENDPOINT_TOKEN_URL=http://hydra:4444/oauth2/token
      - OAUTH2_ISSUER_CLIENT_REDIRECT_URL=https://issuer.trustbloc.local/callback
      - OAUTH2_ISSUER_CLIENT_ID=auth-code-client
      - OAUTH2_ISSUER_CLIENT_SECRET=secret
      # TODO Add tls config for hydra http client https://github.com/trustbloc/edge-sandbox/issues/174
      - OAUTH2_ENDPOINT_TOKEN_INTROSPECTION_URL=http://hydra:4445/oauth2/introspect
      # TODO Add tls config for cms http client https://github.com/trustbloc/edge-sandbox/issues/175
      - ISSUER_CMS_URL=http://oathkeeper-proxy:4455
      # TODO Add tls config for vcs http client https://github.com/trustbloc/edge-sandbox/issues/176
      - ISSUER_VCS_URL=http://issuer.vcs.example.com:8070
      - VIRTUAL_HOST=issuer.trustbloc.local
    ports:
      - 5556:5556
    command: start
    volumes:
      - ../keys/tls:/etc/tls
    networks:
      - demo-net

  rp.example.com:
    container_name: rp.example.com
    image: ${RP_IMAGE}:latest
    environment:
      - RP_HOST_URL=0.0.0.0:5557
      # TODO Add tls config for vcs http client https://github.com/trustbloc/edge-sandbox/issues/176
      - RP_VCS_URL=http://rp.vcs.example.com:8069
      - VIRTUAL_HOST=rp.trustbloc.local
    ports:
      - 5557:5557
    command: start
    volumes:
      - ../keys/tls:/etc/tls
    networks:
      - demo-net
